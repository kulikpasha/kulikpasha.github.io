<body>
  <style>
    * {
      margin: 0;
      padding: 0;
    }
    html,
    body {
      height: 100%;
      font-family: sans-serif;
    }
    table {
      width: 320px;
      height: 320px;
      border: 1px solid #000;
    }
    td {
      vertical-align: center;
      text-align: center;
      font-size: 22px;
      font-weight: 900;
      width: 40px;
      height: 40px;
    }
    .black {
      background-color: brown;
    }
    .white {
      background-color: white;
    }
    .playerBlack {
      color: black;
    }
    .playerWhite {
      color: #ccc;
    }
    .clicked {
      background-color: rgb(206, 237, 10);
    }
    .hoveredwhite {
      background-color: rgb(9, 169, 22);
    }
    .hoveredblack {
      background-color: rgb(2, 70, 2);
    }
    .attack {
      background-color: rgb(216, 8, 8);
    }
  </style>

  <script>
    const table = document.createElement("table");
    table.cellPadding = 0;
    table.cellSpacing = 0;
    let frstclick = { x: -1, y: -1, t: 0, p: 0 };
    function renderfield() {
      for (let i = 0; i < 8; i++) {
        const tr = document.createElement("tr");
        for (let j = 0; j < 8; j++) {
          const td = document.createElement("td");
          if (i % 2 != j % 2 && field[i][j].h == 0) {
            td.classList.add("black");
          } else if (i % 2 != j % 2 && field[i][j].h == 1) {
            td.classList.add("hoveredblack");
          }
          if (i % 2 == j % 2 && field[i][j].h == 1) {
            td.classList.add("hoveredwhite");
          }
          if (field[i][j].h == 2) {
            td.classList.add("clicked");
          }
          if (field[i][j].h == 3) {
            td.classList.add("attack");
          }
          td.innerHTML = "&nbsp;";
          td.innerHTML = field[i][j].t;
          if (field[i][j].p == 1) {
            td.classList.add("playerWhite");
          }
          if (field[i][j].p == -1) {
            td.classList.add("playerBlack");
          }
          td.onclick = () => {
            wasclick(i, j);
          };
          tr.appendChild(td);
        }
        table.appendChild(tr);
      }
      document.body.appendChild(table);
    }

    function wasclick(i, j) {
      if (frstclick.t == 0 && field[i][j].t != "&nbsp;") {
        frstclick = { x: i, y: j, t: field[i][j].t, p: field[i][j].p };
        field[i][j].h = 2;
        if (field[i][j].t == "K") {
          king(i, j);
        } else if (field[i][j].t == "Q") {
          queen(i, j);
        } else if (field[i][j].t == "R") {
          rook(i, j);
        } else if (field[i][j].t == "B") {
          bishop(i, j);
        } else if (field[i][j].t == "P" && field[i][j].p == "1") {
          whitepawn(i, j);
        } else if (field[i][j].t == "P" && field[i][j].p == "-1") {
          blackpawn(i, j);
        } else if (field[i][j].t == "H") {
          horse(i, j);
        }
      } else attack(i, j);
      table.innerHTML = "";
      renderfield();
    }

    function attack(i, j) {
      if (field[i][j].h == 1 || field[i][j].h == 3) {
        field[i][j] = field[frstclick.x][frstclick.y];
        field[frstclick.x][frstclick.y] = { t: "&nbsp;" };
        for (let x = 0; x < 8; x++) {
          for (let y = 0; y < 8; y++) {
            field[x][y].h = 0;
          }
        }

        frstclick = { x: -1, y: -1, t: 0, p: 0 };
        table.innerHTML = "";
        renderfield();
      } else {
        frstclick = { x: -1, y: -1, t: 0, p: 0 };
        for (let x = 0; x < 8; x++) {
          for (let y = 0; y < 8; y++) {
            field[x][y].h = 0;
          }
        }
        table.innerHTML = "";
        renderfield();
      }
    }

    // prettier-ignore
    function whitepawn(i, j) {
      if (i - 1 > -1) {
        if (field[i - 1][j].t == "&nbsp;") {
          field[i - 1][j].h = 1;
        }
      }
      if (i - 1 > -1 && j - 1 > -1) {
        if (field[i - 1][j - 1].t != "&nbsp;" && field[i - 1][j - 1].p != frstclick.p) {
          field[i - 1][j - 1].h = 3;
        }
      }
      if (i - 1 > -1 && j + 1 < 8) {
        if (field[i - 1][j + 1].t != "&nbsp;" && field[i - 1][j + 1].p != frstclick.p) {
          field[i - 1][j + 1].h = 3;
        }
      }
      if (i == 6 && field[i - 1][j].t == "&nbsp;" && field[i - 2][j].t == "&nbsp;") {
        field[i - 2][j].h = 1;
      }
    }

    // prettier-ignore
    function blackpawn(i, j) {
      if (i + 1 < 8) {
        if (field[i + 1][j].t == "&nbsp;") {
          field[i + 1][j].h = 1;
        }
      }
      if (i + 1 < 8 && j + 1 < 8) {
        if (field[i + 1][j + 1].t != "&nbsp;" && field[i + 1][j + 1].p != frstclick.p) {
          field[i + 1][j + 1].h = 3;
        }
      }
      if (i + 1 < 8 && j - 1 > -1) {
        if (field[i + 1][j - 1].t != "&nbsp;" && field[i + 1][j - 1].p != frstclick.p) {
          field[i + 1][j - 1].h = 3;
        }
      }
      if (i == 1 && field[i + 1][j].t == "&nbsp;" && field[i + 2][j].t == "&nbsp;") {
        field[i + 2][j].h = 1;
      }
    }
    function king(i, j) {
      for (let x = -1; x < 2; x++) {
        for (let y = -1; y < 2; y++) {
          if (i + x < 8 && i + x > -1 && j + y < 8 && j + y > -1) {
            if (field[i + x][j + y].t == "&nbsp;") {
              field[i + x][j + y].h = 1;
            } else if (field[i + x][j + y].p != frstclick.p) {
              field[i + x][j + y].h = 3;
            }
          }
        }
      }
    }
    function bishop(i, j) {
      for (let x = 0; x < 8; x++) {
        if (i - x - 1 > -1 && j - x - 1 > -1) {
          if (field[i - x - 1][j - x - 1].t == "&nbsp;") {
            field[i - x - 1][j - x - 1].h = 1;
          } else if (field[i - x - 1][j - x - 1] != "&nbsp;") {
            if (field[i - x - 1][j - x - 1].p != frstclick.p) {
              field[i - x - 1][j - x - 1].h = 3;
            }
            break;
          }
        }
      }
      for (let x = 0; x < 8; x++) {
        if (i + x + 1 < 8 && j - x - 1 > -1) {
          if (field[i + x + 1][j - x - 1].t == "&nbsp;") {
            field[i + x + 1][j - x - 1].h = 1;
          } else if (field[i + x + 1][j - x - 1] != "&nbsp;") {
            if (field[i + x + 1][j - x - 1].p != frstclick.p) {
              field[i + x + 1][j - x - 1].h = 3;
            }
            break;
          }
        }
      }
      for (let x = 0; x < 8; x++) {
        if (i + x + 1 < 8 && j + x + 1 < 8) {
          if (field[i + x + 1][j + x + 1].t == "&nbsp;") {
            field[i + x + 1][j + x + 1].h = 1;
          } else if (field[i + x + 1][j + x + 1] != "&nbsp;") {
            if (field[i + x + 1][j + x + 1].p != frstclick.p) {
              field[i + x + 1][j + x + 1].h = 3;
            }
            break;
          }
        }
      }
      for (let x = 0; x < 8; x++) {
        if (i - x - 1 > -1 && j + x + 1 < 8) {
          if (field[i - x - 1][j + x + 1].t == "&nbsp;") {
            field[i - x - 1][j + x + 1].h = 1;
          } else if (field[i - x - 1][j + x + 1] != "&nbsp;") {
            if (field[i - x - 1][j + x + 1].p != frstclick.p) {
              field[i - x - 1][j + x + 1].h = 3;
            }
            break;
          }
        }
      }
    }
    const horseturns = [
      [2, 1],
      [2, -1],
      [-2, 1],
      [-2, -1],
      [1, 2],
      [1, -2],
      [-1, 2],
      [-1, -2],
    ];
    function horse(i, j) {
      for (let x = 0; x < 8; x++) {
        if (
          horseturns[x][0] + i < 8 &&
          horseturns[x][1] + j < 8 &&
          horseturns[x][0] + i > -1 &&
          horseturns[x][1] + j > -1
        ) {
          if (field[i + horseturns[x][0]][j + horseturns[x][1]].t == "&nbsp;") {
            field[i + horseturns[x][0]][j + horseturns[x][1]].h = 1;
          } else {
            if (
              field[i + horseturns[x][0]][j + horseturns[x][1]].p != frstclick.p
            ) {
              field[i + horseturns[x][0]][j + horseturns[x][1]].h = 3;
            }
          }
        }
      }
    }
    function queen(i, j) {
      for (let x = 0; x < 8; x++) {
        if (i - x - 1 > -1 && j - x - 1 > -1) {
          if (field[i - x - 1][j - x - 1].t == "&nbsp;") {
            field[i - x - 1][j - x - 1].h = 1;
          } else if (field[i - x - 1][j - x - 1] != "&nbsp;") {
            if (field[i - x - 1][j - x - 1].p != frstclick.p) {
              field[i - x - 1][j - x - 1].h = 3;
            }
            break;
          }
        }
      }
      for (let x = 0; x < 8; x++) {
        if (i + x + 1 < 8 && j - x - 1 > -1) {
          if (field[i + x + 1][j - x - 1].t == "&nbsp;") {
            field[i + x + 1][j - x - 1].h = 1;
          } else if (field[i + x + 1][j - x - 1] != "&nbsp;") {
            if (field[i + x + 1][j - x - 1].p != frstclick.p) {
              field[i + x + 1][j - x - 1].h = 3;
            }
            break;
          }
        }
      }
      for (let x = 0; x < 8; x++) {
        if (i + x + 1 < 8 && j + x + 1 < 8) {
          if (field[i + x + 1][j + x + 1].t == "&nbsp;") {
            field[i + x + 1][j + x + 1].h = 1;
          } else if (field[i + x + 1][j + x + 1] != "&nbsp;") {
            if (field[i + x + 1][j + x + 1].p != frstclick.p) {
              field[i + x + 1][j + x + 1].h = 3;
            }
            break;
          }
        }
      }
      for (let x = 0; x < 8; x++) {
        if (i - x - 1 > -1 && j + x + 1 < 8) {
          if (field[i - x - 1][j + x + 1].t == "&nbsp;") {
            field[i - x - 1][j + x + 1].h = 1;
          } else if (field[i - x - 1][j + x + 1] != "&nbsp;") {
            if (field[i - x - 1][j + x + 1].p != frstclick.p) {
              field[i - x - 1][j + x + 1].h = 3;
            }
            break;
          }
        }
      }
      for (let x = i - 1; x > -1; x--) {
        if (field[x][j].t == "&nbsp;") {
          field[x][j].h = 1;
        } else if (field[x][j].t != "&nbsp;") {
          if (field[x][j].p != frstclick.p) {
            field[x][j].h = 3;
          }
          break;
        }
      }
      for (let x = i + 1; x < 8; x++) {
        if (field[x][j].t == "&nbsp;") {
          field[x][j].h = 1;
        } else if (field[x][j].t != "&nbsp;") {
          if (field[x][j].p != frstclick.p) {
            field[x][j].h = 3;
          }
          break;
        }
      }
      for (let x = j - 1; x > -1; x--) {
        if (field[i][x].t == "&nbsp;") {
          field[i][x].h = 1;
        } else if (field[i][x].t != "&nbsp;") {
          if (field[i][x].p != frstclick.p) {
            field[i][x].h = 3;
          }
          break;
        }
      }
      for (let x = j + 1; x < 8; x++) {
        if (field[i][x].t == "&nbsp;") {
          field[i][x].h = 1;
        } else if (field[i][x].t != "&nbsp;") {
          if (field[i][x].p != frstclick.p) {
            field[i][x].h = 3;
          }
          break;
        }
      }
    }
    function rook(i, j) {
      for (let x = i - 1; x > -1; x--) {
        if (field[x][j].t == "&nbsp;") {
          field[x][j].h = 1;
        } else if (field[x][j].t != "&nbsp;") {
          if (field[x][j].p != frstclick.p) {
            field[x][j].h = 3;
          }
          break;
        }
      }
      for (let x = i + 1; x < 8; x++) {
        if (field[x][j].t == "&nbsp;") {
          field[x][j].h = 1;
        } else if (field[x][j].t != "&nbsp;") {
          if (field[x][j].p != frstclick.p) {
            field[x][j].h = 3;
          }
          break;
        }
      }
      for (let x = j - 1; x > -1; x--) {
        if (field[i][x].t == "&nbsp;") {
          field[i][x].h = 1;
        } else if (field[i][x].t != "&nbsp;") {
          if (field[i][x].p != frstclick.p) {
            field[i][x].h = 3;
          }
          break;
        }
      }
      for (let x = j + 1; x < 8; x++) {
        if (field[i][x].t == "&nbsp;") {
          field[i][x].h = 1;
        } else if (field[i][x].t != "&nbsp;") {
          if (field[i][x].p != frstclick.p) {
            field[i][x].h = 3;
          }
          break;
        }
      }
    }

    // prettier-ignore
    const field = [
        [{p: -1, t: "R", h: 0}, {p: -1, t: "H", h: 0},{p: -1, t: "B", h: 0},{p: -1, t: "Q", h: 0},{p: -1, t: "K", h: 0},{p: -1, t: "B", h: 0},{p: -1, t: "H", h: 0},{p: -1, t: "R", h: 0}],
        [{p: -1, t: "P", h: 0},{p: -1, t: "P", h: 0},{p: -1, t: "P", h: 0},{p: -1, t: "P", h: 0},{p: -1, t: "P", h: 0},{p: -1, t: "P", h: 0},{p: -1, t: "P", h: 0},{p: -1, t: "P", h: 0}],
        [{t: "&nbsp;", h: 0}, {t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0}],
        [{t: "&nbsp;", h: 0}, {t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0}],
        [{t: "&nbsp;", h: 0}, {t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0}],
        [{t: "&nbsp;", h: 0}, {t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0},{t: "&nbsp;", h: 0}],
        [{p: 1, t: "P", h: 0}, {p: 1, t: "P", h: 0},{p: 1, t: "P", h: 0},{p: 1, t: "P", h: 0},{p: 1, t: "P", h: 0},{p: 1, t: "P", h: 0},{p: 1, t: "P", h: 0},{p: 1, t: "P", h: 0}],
        [{p: 1, t: "R", h: 0}, {p: 1, t: "H", h: 0},{p: 1, t: "B", h: 0},{p: 1, t: "Q", h: 0},{p: 1, t: "K", h: 0},{p: 1, t: "B", h: 0},{p: 1, t: "H", h: 0},{p: 1, t: "R", h: 0}]
    ];
    renderfield();
  </script>
</body>
